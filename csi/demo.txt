
###
testing 2.1

###review driver config

vi ~/git/csi-isilon/my-isilon-settings.yaml

###review pods
kubectl get pods -A 

kubectl get pods -n isilon

watch kubectl get pods -A 


kubectl describe pod -n isilon <controller-id> 



vi ~/git/csi-isilon/my-isilon-sc.yaml
kubectl get sc


kubectl get pods -n test




###sample test files:  ~/git/csi-isilon/samples

cd ~/git/csi-isilon/samples


###
look at isilon config
-network
-nfs
-quotas
-snapshot


pod -- > pv --> pvc --> sc   


###create a pvc
vi persistentvolumeclaim/pvc.yaml

kubectl create -f persistentvolumeclaim/pvc.yaml -n test


kubectl get pvc -n test


kubectl describe pvc test-pvc -n test


kubectl get pv -n test


kubectl describe pv <pv name> -n test


go to isilon, review
nfs
quota
add a file from cli


###look a simple pod definition 
vi pod/nginx.yaml

###review volumes, 
claim name = test-pvc  we just created
mount point in the 


kubectl create -f pod/nginx.yaml -n test


kubectl get pods -n test


kubectl describe pods ngnix-pv-pod -n test


###access the pod
kubectl exec ngnix-pv-pod -i -t -n test -- bash 

cd /usr/share/nginx/html/
ls -al
touch test1.txt


###from isilon cli, browse to the directory mounted by the pod






###snapshots
###VolumeSnapshotClass is needed for creating the volume snapshots

cd ~/git/csi-isilon/samples
vi volumesnapshotclass/isilon-volumesnapshotclass-v1.yaml

###modify path as needed

isiPath: "/ifs/csi"


###create the volumesnapshotclass in the namespace as the pvc and the pod
kubectl create -f volumesnapshotclass/isilon-volumesnapshotclass-v1.yaml -n test
kubectl get Volumesnapshotclass -n test


###create the snapshot

vi volumesnapshot/snapshot-of-test-pvc.yaml
-review api version and change v1beta -- v1
-review and set the namespace = test


kubectl create -f volumesnapshot/snapshot-of-test-pvc.yaml -n test
kubectl get volumesnapshot -n test



###view snapshot
kubectl exec ngnix-pv-pod -i -t -n test -- bash
cd /usr/share/nginx/html/.snapshot
cd <snapshot-id>
ls -al
exit



###deletethe snapshot
kubectl get volumesnapshot -n test
kubectl delete volumesnapshot snapshot-of-test-pvc -n test


###cleanup
kubectl get pods -n test
kubectl delete -f pod/ngnix.yaml -n test
kubectl get pods -n test


kubectl get pvc -n test
kubectl delete pvc test-pvc -n test
kubectl get pvc -n test
kubectl get pv -n test



















####misc useful sometimes
kubectl get pv k8s-56da61f45b
kubectl describe pv k8s-56da61f45b
kubectl get volumeattachment -n test
kubectl delete volumeattachment csi-e38eb79827b44396bd1520ab916091671c4d696ea9bfd4d54be428aa80e4b586 -n test