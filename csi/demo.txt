
###
testing 1.6
###sample test files:  ~/git/csi-isilon/samples

cd ~/git/csi-isilon/samples


###
look at nfs exports isilon

###create a pvc
vi persistentvolumeclaim/pvc.yaml

kubectl create -f persistentvolumeclaim/pvc.yaml -n test
kubectl get pvc -n test
kubectl describe pvc test-pvc -n test
kubectl get pvc -n test


kubectl create -f pod/nginx.yaml -n test
kubectl get pods -n test
kubectl describe pods ngnix-pv-pod -n test


###access the pod
kubectl exec ngnix-pv-pod -i -t -n test -- bash 

cd /usr/share/nginx/html/
ls -al
touch test1.txt

###from isilon cli, browse to the directory mounted by the pod

###snapshots
###VolumeSnapshotClass is needed for creating the volume snapshots

cd ~/git/csi-isilon/samples
vi volumesnapshotclass/isilon-volumesnapshotclass-v1.yaml

###modify path as needed

isiPath: "/ifs/csi"


###create the volumesnapshotclass in the namespace as the pvc and the pod
kubectl create -f volumesnapshotclass/isilon-volumesnapshotclass-v1.yaml -n test
kubectl get Volumesnapshotclass -n test


###create the snapshot

vi volumesnapshot/snapshot-of-test-pvc.yaml
-review api version and change v1beta -- v1
-review and set the namespace = test


kubectl create -f volumesnapshot/snapshot-of-test-pvc.yaml -n test
kubectl get volumesnapshot -n test



###view snapshot
kubectl exec ngnix-pv-pod -i -t -n test -- bash
cd /usr/share/nginx/html/.snapshot
cd <snapshot-id>
ls -al




###deletethe snapshot
kubectl get volumesnapshot -n test
kubectl delete volumesnapshot snapshot-of-test-pvc -n test


###cleanup
kubectl get pods -n test
kubectl delete -f pod/nginx.yaml -n test

kubectl get pvc  -n test
kubectl delete pvc tets-pvc -n test

kubectl get pv
kubectl delete pv <k8s-ec5c9fec46>


















####misc useful sometimes
kubectl get pv k8s-56da61f45b
kubectl describe pv k8s-56da61f45b
kubectl get volumeattachment -n test
kubectl delete volumeattachment csi-e38eb79827b44396bd1520ab916091671c4d696ea9bfd4d54be428aa80e4b586 -n test